# Проект Cards Shop Spring

## Текущая задача
Разработка бэкенда для минисайта с функциональностью работы с товарами и корзиной.

## Планирование

### Этапы разработки
- [ ] Настройка проекта Spring Boot
- [ ] Создание моделей данных
- [ ] Разработка репозиториев
- [ ] Разработка сервисов
- [ ] Создание REST контроллеров
- [ ] Настройка аутентификации
- [ ] Документация API
- [ ] Контейнеризация

## Прогресс
- [X] Инициализация проекта
- [X] Настройка Spring Boot
- [X] Создание контроллеров
- [X] Настройка базы данных
- [X] Создание Docker-образа
- [X] Создание моделей данных
  - [X] Модель Product
  - [X] Модель User
  - [X] Модель Cart
- [X] Подготовка тестового REST API
  - [X] Контроллер для Product
  - [X] PowerShell-скрипт для тестирования
- [X] Развертывание приложения
  - [X] Настройка Docker Compose
  - [X] Скрипт сборки и запуска
- [X] Настройка безопасности
  - [X] Базовая конфигурация Spring Security
  - [X] Разрешение доступа к API-эндпоинтам

## Текущие проблемы
- [ ] Необходимо добавить полноценную аутентификацию
- [ ] Реализовать механизмы авторизации для разных ролей пользователей

## Развертывание
Подготовлены следующие скрипты для работы с приложением:
- `build_and_run.ps1`: Полный цикл сборки и запуска приложения
- `test_products.ps1`: Тестирование REST API продуктов

Порядок работы:
1. Выполнить `build_and_run.ps1`
2. Дождаться полной инициализации контейнеров
3. Проверить работоспособность через тестовые запросы

## Тестирование
Для тестирования API подготовлен PowerShell-скрипт `test_products.ps1`, который выполняет следующие действия:
1. Инициализация тестовых продуктов
2. Получение списка всех продуктов
3. Получение продукта по ID
4. Создание нового продукта
5. Получение обновленного списка продуктов

## Lessons
- При работе с Java-проектами без Maven необходимо тщательно учитывать транзитивные зависимости
- Ручная загрузка библиотек требует полного понимания графа зависимостей
- Рекомендуется использовать официальные образы с предустановленными инструментами сборки
- Важно внимательно проверять версии библиотек и их совместимость
- Использование многоступенчатой сборки в Docker значительно упрощает процесс компиляции
- Необходимо явно указывать параметры подключения к базе данных в переменных окружения

## Errors
- **[10.02.2025, 14:20]** На данный момент ошибок нет. Проект находится в стадии готовности к тестированию.
- **[10.02.2025, 14:50]** Проблемы с Docker-сборкой:
  * Не удается собрать образ из-за проблем с загрузкой PowerShell и зависимостей
  * Необходимо оптимизировать Dockerfile
- **[11.02.2025, 15:02]** Проблемы с компиляцией в Docker:
  * Не хватает полного набора зависимостей для компиляции
  * Необходимо настроить ручную компиляцию без Maven
  * Возможно, потребуется создать скрипт компиляции
- **[11.02.2025, 15:30]** Критические проблемы компиляции:
  * Отсутствуют транзитивные зависимости Spring Framework
  * Ручная загрузка библиотек не покрывает всех необходимых импортов
  * Требуется полный пересмотр стратегии сборки проекта
- **[11.02.2025, 15:45]** Проблемы с Maven-сборкой:
  * Не удается скомпилировать проект из-за неизвестной ошибки в импортах
  * Необходимо проверить зависимости и версии библиотек
  * Возможно, требуется обновление версий или перенастройка Maven

## Bug Logs
### Bug #1: Проблема подключения к базе данных PostgreSQL
- **Описание**: При запуске приложения возникает ошибка подключения к базе данных
- **Статус**: Не решено
- **Симптомы**: 
  - Ошибка в логах при попытке установить соединение с базой данных
  - Невозможность выполнить DDL-операции
- **Возможные причины**:
  - Неправильная конфигурация подключения
  - Проблемы с сетевым взаимодействием
  - Неверные учетные данные
- **Предпринятые действия**:
  - Проверены настройки `application.properties`
  - Изменены параметры подключения
  - Использован `host.docker.internal` для маршрутизации

## Lessons
- При работе с Docker и базами данных необходимо тщательно проверять сетевые настройки
- Использование `host.docker.internal` может не всегда работать корректно
- Важно добавлять подробное логирование для диагностики проблем подключения
- Необходимо проверять доступность базы данных до запуска приложения

## Диагностика подключения к базе данных
### Текущий статус
- [X] Запущен контейнер PostgreSQL
- [X] Настроено подключение к базе данных
- [X] Приложение успешно стартовало
- [ ] Проблемы с доступом к API

### Проблемы
- Не удается подключиться к localhost:8080
- Возможные причины:
  1. Неправильная конфигурация сети Docker
  2. Приложение не слушает нужный порт
  3. Firewall блокирует подключение

### Следующие шаги диагностики
- [ ] Проверить сетевые настройки контейнера
- [ ] Проверить логи приложения на наличие ошибок старта
- [ ] Убедиться, что порт 8080 открыт и доступен

### Результаты
- **Порт базы данных**: 5432
- **Сетевой режим**: host
- **Время запуска приложения**: 5.173 секунды
- **Найдено JPA репозиториев**: 3

### Детали конфигурации
```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/cardshop
spring.datasource.username=postgres
spring.datasource.password=postgres
```

### Логи приложения
- Использована Java 17.0.14
- Встроенный сервер Tomcat запущен на порту 8080
- Никаких критических ошибок не обнаружено

### Следующие шаги
- [ ] Проверить работоспособность API-эндпоинтов
- [ ] Выполнить тестирование подключения к базе данных
- [ ] Проверить корректность миграций и схемы базы данных

## Следующие шаги
- Запустить Docker-сборку
- Проверить работоспособность приложения через Docker Compose
