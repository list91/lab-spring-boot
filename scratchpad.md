# Cards Shop Spring Project Scratchpad

## Текущая задача
Продолжение разработки проекта с фокусом на тестировании сервисов и улучшении общей архитектуры.

## Текущие приоритеты
- [x] Завершить тестирование UserService
- [x] Написать тесты для CategoryService
- [x] Подготовить интеграционные тесты
- [x] Улучшить обработку ошибок
- [x] Добавить расширенную валидацию данных
- [x] Добавить Swagger/OpenAPI документацию
- [x] Обработка исключений

## Lessons
- Важно использовать Docker для развертывания Java-приложений
- Необходимо периодически запускать приложение для проверки работоспособности
- Постоянно актуализировать Currentprogressfile
- При работе с пользователями всегда кодировать пароли
- Добавлять проверку уникальности email и username
- Использовать специфические исключения для разных сценариев
- Создавать тесты для всех основных методов сервисов
- Использовать in-memory базу данных для интеграционных тестов

## Следующие шаги
1. ~~Просмотреть текущую реализацию UserService~~
2. ~~Определить недостающие тесты~~
3. ~~Написать и отладить тесты для UserService~~
4. ~~Написать тесты для CategoryService~~
5. ~~Подготовить интеграционные тесты~~
6. Провести рефакторинг кода при необходимости

## Заметки по тестированию
- Использовать JUnit 5
- Применять Mockito для мокирования зависимостей
- Минимизировать конфигурацию Spring Context
- Покрывать основные сценарии и краевые случаи
- Использовать H2 для интеграционных тестов
- Настраивать отдельный профиль для тестирования

## Метрики прогресса
- Текущее покрытие кода тестами: ~70%
- Цель: увеличить до 80-90%

## Детали обновления UserService
- Добавлено кодирование пароля через PasswordEncoder
- Улучшена обработка ошибок с использованием IllegalArgumentException
- Добавлены методы проверки уникальности email и username
- Расширено тестовое покрытие для всех методов сервиса

## Детали обновления CategoryService
- Созданы тесты для всех основных методов сервиса
- Покрыты сценарии создания, обновления, удаления и поиска категорий
- Проверены краевые случаи (например, поиск несуществующей категории)
- Использован подход с мокированием зависимостей

## Детали интеграционных тестов
- Создан тест UserCategoryIntegrationTest
- Проверена работа UserService и CategoryService с реальной базой данных
- Использована in-memory база данных H2
- Настроен отдельный профиль для тестирования
- Покрыты сценарии создания, обновления, удаления и поиска
- Проверены ограничения уникальности и валидации

## Детали Swagger/OpenAPI
- Добавлены зависимости Springdoc OpenAPI
- Создан `SwaggerConfig` с группировкой API
- Обновлены контроллеры с аннотациями OpenAPI
- Настроены свойства в `application.properties`
- Добавлена документация для эндпоинтов

## Детали обработки исключений
- Создан глобальный обработчик исключений `GlobalExceptionHandler`
- Добавлены пользовательские исключения
  - `UserAlreadyExistsException`
  - `ResourceNotFoundException`
- Расширена обработка различных сценариев ошибок
  - Валидация данных
  - Нарушение целостности данных
  - Отсутствие ресурсов
  - Проблемы аутентификации
- Информативные сообщения об ошибках
- Стандартизация форматов ошибок
- Журналирование ошибок в сервисах
